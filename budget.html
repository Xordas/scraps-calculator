<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraps Odds Calculator</title>
    <style>
        :root {
        color-scheme: light dark; 
        --bg-color: #ffffff;
        --text-color: #1a1a1a;
        --bg-color-button: #7c7c7c; 
        --text-color-button: #1a1a1a; 
        }

        @media (prefers-color-scheme: dark) {
        :root {
            --bg-color: #1a1a1a;
            --text-color: #f5f5f5; 
            --bg-color-button: rgb(59, 59, 59);
            --text-color-button: #f5f5f5;
            /* waow dark mode!!! */
        }
        }

        body {
        background-color: var(--bg-color);
        color: var(--text-color);
        }

        .Button {
        background-color: var(--bg-color-button);
        color: var(--text-color-button);
        }
    </style>

    <script>
        if (localStorage.getItem("ga_disabled") !== "1") {
            const script = document.createElement("script");
            script.async = true;
            script.src = `https://www.googletagmanager.com/gtag/js?id=G-TXDF9RQ82V`;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            window.gtag = window.gtag || function(){dataLayer.push(arguments);};

            gtag('js', new Date());
            gtag('config', 'G-TXDF9RQ82V');
        }

        function gaOptout() {
            if (localStorage.getItem("ga_disabled") !== "1") {
                localStorage.setItem("ga_disabled", "1");
                alert("Google Analytics has been disabled. Please refresh the page for the changes to take effect.");
            } else if (localStorage.getItem("ga_disabled") === "1") {
                localStorage.setItem("ga_disabled", "0");
                alert("Google Analytics has been enabled. Please refresh the page for the changes to take effect.");

            }
        }
    </script>

</head>
<body>
    <h1>Scraps Odds Calculator</h1>
    <p>Do not write percentages, write just the number instead (im too lazy to add input validation)</p><br>

    <p>Price per roll:</p>
    <input type="text" id="PricePerRollInput" placeholder="Price per roll"> <br>
    <p>Default roll chance:</p>
    <input type="text" id="DefaultRollChanceInput" placeholder="Default roll chance"> <br>
    <p>Price per upgrade:</p>
    <input type="text" id="PricePerUpgradeInput" placeholder="Price per upgrade"> <br>
    <p>Upgrade chance increase:</p>
    <input type="text" id="UpgradeChanceIncreaseInput" placeholder="Upgrade chance increase"> <br>
    <p>Budget:</p>
    <input type="text" id="BudgetInput" placeholder="Budget"> <br><br>

    <button class="Button" id="CalculateButton">Calculate</button>

    <p id="Result"></p>
    <p id="Result2"></p>
    <p id="Result3"></p>

    <br><br><br><br><br><br>
    <a href="javascript:gaOptout()">Click here to opt-out of Google Analytics (click again to enable)</a>
    <script>

    </script>


    <!-- I know its not optimized but it work doesnt it? -->
    <!-- Max performance isnt needed for a script like this -->
    <script>

        document.getElementById("CalculateButton").addEventListener("click", function() {
            const PricePerRoll = parseFloat(document.getElementById("PricePerRollInput").value);
            const DefaultRollChance = parseFloat(document.getElementById("DefaultRollChanceInput").value);
            const PricePerUpgrade = parseFloat(document.getElementById("PricePerUpgradeInput").value);
            const UpgradeChanceIncrease = parseFloat(document.getElementById("UpgradeChanceIncreaseInput").value);
            const Budget = parseFloat(document.getElementById("BudgetInput").value);

            if (isNaN(PricePerRoll) || isNaN(DefaultRollChance) || isNaN(PricePerUpgrade) ||
                isNaN(UpgradeChanceIncrease) || isNaN(Budget)) {
                document.getElementById("Result").textContent = "Please fill in all fields correctly.";
                document.getElementById("Result2").textContent = "";
                return;
            }
            // Fixed budget so just brute force all combinations that are within budget
            let BestProbability = -1;
            let BestUpgrades = 0;
            let BestRolls = 0;
            let BestChancePerRoll = 0;
            let BestCost = 0;

            // Maximum upgrades possible
            const MaxUpgrades = Math.ceil((100 - DefaultRollChance) / UpgradeChanceIncrease);

            for (let Upgrades = 0; Upgrades <= MaxUpgrades; Upgrades++) {
                let ChancePerRoll = DefaultRollChance + (Upgrades * UpgradeChanceIncrease);
                if (ChancePerRoll > 100) ChancePerRoll = 100;

                const P = ChancePerRoll / 100;

                const costForUpgrades = Upgrades * PricePerUpgrade;
                const remainingBudget = Budget - costForUpgrades;

                if (remainingBudget < PricePerRoll) {
                    // Can't buy any rolls with this number of upgrades
                    continue;
                }

                const RollsCanBuy = Math.floor(remainingBudget / PricePerRoll);

                const RollsBought = RollsCanBuy;

                const successProbability = 1 - Math.pow(1 - P, RollsBought);

                const totalCostUsed = costForUpgrades + (RollsBought * PricePerRoll);

                // Prefer higher probability, if probabilities are equal, prefer lower cost
                if (successProbability > BestProbability || (Math.abs(successProbability - BestProbability) < 1e-12 && totalCostUsed < BestCost)) {
                    BestProbability = successProbability;
                    BestUpgrades = Upgrades;
                    BestRolls = RollsBought;
                    BestChancePerRoll = ChancePerRoll;
                    BestCost = totalCostUsed;
                }
            }

            if (BestProbability < 0) {
                document.getElementById("Result").textContent = "Budget too small to buy any rolls with available upgrade choices.";
                document.getElementById("Result2").textContent = "";
                document.getElementById("Result3").textContent = "";
                return;
            }

            document.getElementById("Result").textContent = `Optimal strategy --> Upgrades: ${BestUpgrades}, Rolls: ${BestRolls}`;

            document.getElementById("Result2").textContent =
                `Success chance: ${(BestProbability * 100).toFixed(2)}% | Cost used: ${BestCost.toFixed(2)} | Chance per roll: ${BestChancePerRoll.toFixed(2)}% | Leftover: ${(Budget - BestCost).toFixed(2)}`;

            document.getElementById("Result3").textContent =
                `Hours: ${(BestCost / 14).toFixed(2)} (T1), ${(BestCost / 16).toFixed(2)} (T2), ${(BestCost / 20).toFixed(2)} (T3), ${(BestCost / 24).toFixed(2)} (T4)`;
        });


    </script>
</body>

</html>